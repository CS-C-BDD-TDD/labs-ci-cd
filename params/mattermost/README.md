# mattermost messaging app
The `team` edition of [Mattermost](https://docs.mattermost.com/) for running on OpenShift and intergrated with GitLab for authentication giving users a single useridentity across the ci/cd labs stack.

## Three components
1. PostgreSQL - for storing the user conf etc.
1. Config Map - GIANT JSON object which contains all the relevant information and configuration for the mattermost app. This could be trimmed slightly but the important bits that need to be completed are the DB*, SMTP* and GITLAB* variables for connecting mattermost up for auth and mailing etc.
1. App - the mattermost app itself with some very minor permission fixes to allow it run in OCP. Volume mount is required for storing app data.  

## Vars to fill out when applying this template
1. In `config-map`
```bash
POSTGRESQL_USER=mattermost
# use the template random password generator!
POSTGRESQL_PASSWORD=password
# the collection the app will
POSTGRESQL_DATABASE=mattermost
```
1. In `config-map`
```bash
# the exposed route of the mattermost app
SITE_URL=https://mattermost.apps.example.com
# the email creds if using gmail or somesuch smtp server
SMTP_PASSWORD=password
SMTP_USERNAME=noreply.address.mattermost@gmail.com
# the gitlab oauth creds; generated by going to /profile/applications on your gitlab instance
# see here for more info [mattermost-gitlab](https://docs.mattermost.com/deployment/sso-gitlab.html)
GITLAB_OATUH_SECRET=81e3213
GITLAB_OAUTH_ID=1245612
GITLAB_URL=gitlab.somesite.com
# db creds created above
POSTGRESQL_PASSWORD=password
POSTGRESQL_SERVICE=postgresql.namespace.svc.cluster.local 
```

1. In `app`
```bash
# the name of the app
NAME=mattermost
# pvc size (mounted at /mattermost/data)
VOLUME_CAPACITY=5Gi
```